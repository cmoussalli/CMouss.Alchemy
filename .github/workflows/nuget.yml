name: Deploy to Nuget

on: push

env:
	PROJECT0_PATH: CMouss.Alchemy/CMouss.Alchemy.csproj
	PACKAGE_OUTPUT: ${{ github.workspace }}\output
	NUGET_SOURCE : https://api.nuget.org/v3/index.json

jobs:
	deploy:
		runs-on: windows-latest
		steps:
		- name: Checkout
		  uses: actions/checkout@v2

		- name: Installdotnet
		  uses: actions/setup-dotnet@v6
		  with:
			dotnet-version: 6.0

		- name: 'Restore packages'
		run: dotnet restore ${{ env.PROJECT0_PATH }}

		- name: 'Build project'
		run: dotnet build ${{ env.PROJECT0_PATH }} --no-restore Release

		- name: 'Pack project'
		run: dotnet pack ${{ env.PROJECT0_PATH }} --no-resore --no-build --configuration Release --include-symbols --output ${{ env.PACKAGE_OUTPUT }}

		- name: "Push package"
		run: dotnet nuget push ${{ env.PACKAGE_OUTPUT }}\*.nupkg -k ${{ secrets.NUGETKEY }} -s ${{ env.NUGET_SOURCE }}
